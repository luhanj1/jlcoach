<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLCoach - Simulátor Apple iPhone 16</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="https://i.postimg.cc/MGvCz4R4/IMG-0089.jpg" type="image/x-icon">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            box-sizing: border-box;
        }

        /* Kontejner pro samotné zařízení iPhone */
        #iphone-device {
            width: 360px; /* Šířka rámečku */
            height: 700.3px; /* Výška rámečku */
            background-color: #1c1c1e; /* Barva rámečku */
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3), 0 0 0 2px rgba(0,0,0,0.1);
            border-radius: 50px; /* Zaoblení vnějšího telefonu */
            overflow: hidden; 
        }

        /* Samotná simulovaná obrazovka */
        #simulated-screen {
            position: absolute;
            top: 14px;    
            left: 14px;   
            right: 14px;  
            bottom: 14px; 
            background-color: #000000; 
            border-radius: 40px; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Dynamic Island (výřez obrazovky) */
        .dynamic-island {
            position: absolute;
            top: 18px; 
            left: 50%;
            transform: translateX(-50%);
            width: 120px; 
            height: 28px;  
            background-color: #000; 
            border-radius: 14px; 
            z-index: 15; 
        }

        /* Tlačítka na stranách telefonu */
        .iphone-side-button {
            position: absolute;
            background-color: #6a6a6a; 
            cursor: pointer;
            z-index: 0; 
            box-shadow: inset 0 0 1px #ffffff1a;
        }
        .iphone-side-button:active {
            background-color: #3a3a3c; 
        }
        .volume-button-up {
            width: 6px; 
            height: 40px; 
            left: 2px; 
            top: 110px; 
            border-radius: 0 3px 3px 0;
        }
        .volume-button-down {
            width: 6px;
            height: 40px;
            left: 2px;
            top: 165px; 
            border-radius: 0 3px 3px 0;
        }
        .side-button-power {
            width: 14px;
            height: 80px; 
            right: -8px; 
            top: 115px;
            border-radius: 3px 0 0 3px;
        }

        .screen-view {
            width: 100%;
            height: 100%;
            display: none; 
            flex-direction: column; 
            animation: fadeIn 0.3s ease-in-out;
            position: relative; 
            background-color: #fff; 
        }
        .screen-view.active { display: flex; } 
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Status bar */
        .status-bar {
            padding: 18px 20px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600; 
            position: absolute; 
            top: 0; left: 0; right: 0;
            z-index: 10; 
            color: #333333;
            cursor: pointer; 
        }
        .status-bar .operator-name, .status-bar .status-bar-time { margin-left: 0; } 
        .status-bar .icons { display: flex; align-items: center; }
        .status-bar .icons svg { height: 16px; fill: #333333; }
        .status-bar .icons .ios-battery-icon { height: 17px; }
        .status-bar .icons .ios-5g-icon text { font-family: 'Inter', sans-serif; font-weight: 600; }

        /* Indikátor hlasitosti */
        #volume-indicator-overlay {
            position: absolute;
            left: 20px; 
            top: 150px; 
            transform: translateY(-50%); 
            background-color: rgba(50, 50, 50, 0.85);
            border-radius: 16px;
            padding: 8px 6px; 
            z-index: 30; 
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none; 
            width: 32px; 
            height: 140px; 
            display: flex;
            flex-direction: column; 
            justify-content: flex-end; 
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        #volume-indicator-overlay.visible {
            opacity: 1;
            transform: translateY(-50%) translateX(0); 
        }
        #volume-indicator-overlay.hidden-animation {
             transform: translateY(-50%) translateX(-10px); 
        }
        #volume-level-bar-container {
            width: 8px; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.25); 
            border-radius: 4px; 
            overflow: hidden;
            display: flex; 
            flex-direction: column;
            justify-content: flex-end;
        }
        #volume-level-bar {
            width: 100%; 
            background-color: #ffffff; 
            border-radius: 4px; 
            height: 0%; 
            transition: height 0.15s linear; 
        }

        #lock-screen {
            background-image: radial-gradient(circle, #e20074, #ffffff);
            color: #333333;
        }
        .lock-screen-content-wrapper { 
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            padding-top: 55px; 
            width: 100%;
        }
        .lock-screen-top-info {
            display: flex; flex-direction: column; align-items: center;
            width: 100%;
            margin-top: 30px;
        }
        .lock-screen-top-info .current-time-large { font-size: 4.5rem; font-weight: 200; margin-bottom: 8px; }
        .lock-screen-top-info .current-date { font-size: 1.125rem; font-weight: 500; color: #555555; }

        .lock-screen-bottom-controls { 
            display: flex; flex-direction: column; align-items: center;
            width: 100%;
            margin-top: auto; 
            padding-bottom: 5px; 
        }
        .lock-screen-shortcuts {
            display: flex; justify-content: space-between;
            width: 100%; padding: 0 50px 20px; box-sizing: border-box;
        }
        .shortcut-button {
            background-color: rgba(0, 0, 0, 0.12); border-radius: 50%;
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            border: none; cursor: pointer; transition: background-color 0.2s;
        }
        .shortcut-button svg { fill: #333333; width: 22px; height: 22px; }
        .shortcut-button:hover { background-color: rgba(0, 0, 0, 0.2); }
        .shortcut-button.active { background-color: rgba(255, 255, 255, 0.3); }
        .shortcut-button.active svg { fill: #000000; }

        .home-indicator-area {
            padding: 15px 0 8px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            cursor: pointer;
            width: 100%; 
            position: relative; 
            z-index: 20; 
        }
        .home-indicator-bar {
            width: 130px; height: 5px; background-color: rgba(51, 51, 51, 0.6);
            border-radius: 2.5px;
        }

        #passcode-screen {
            background-image: radial-gradient(circle, #e20074, #ffffff);
            color: #333333;
        }
        .passcode-screen-wrapper { 
            flex-grow: 1; 
            display: flex; flex-direction: column; justify-content: center; 
            align-items: center;
            padding: 20px;
            padding-top: 55px; 
            box-sizing: border-box;
            width: 100%;
        }
        .passcode-prompt {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 20px;
            margin-top: 5px; 
        }
        .passcode-circles { display: flex; gap: 18px; margin-bottom: 40px; }
        .passcode-circles .circle {
            width: 16px; height: 16px; border: 1.5px solid rgba(51, 51, 51, 0.6);
            border-radius: 50%; transition: background-color 0.2s;
        }
        .passcode-circles .circle.filled { background-color: rgba(51, 51, 51, 0.8); border-color: rgba(51, 51, 51, 0.8); }
        .passcode-circles.shake { animation: shake-circles 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake-circles {
            10%, 90% { transform: translateX(-2px); } 20%, 80% { transform: translateX(4px); }
            30%, 50%, 70% { transform: translateX(-6px); } 40%, 60% { transform: translateX(6px); }
        }

        .keypad {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 15px; width: 100%; max-width: 300px; margin-bottom: 30px;
        }
        .keypad-button {
            width: 75px; height: 75px; border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.12); color: #333333;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: background-color 0.2s;
            border: none; padding: 0; margin: 0 auto;
        }
        .keypad-button:hover { background-color: rgba(0, 0, 0, 0.2); }
        .keypad-button .digit { font-size: 2rem; font-weight: 400; }
        .keypad-button .letters { font-size: 0.65rem; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; opacity: 0.7; margin-top: 2px; }

        .passcode-actions { 
            display: flex; justify-content: space-between;
            width: 100%; max-width: 300px; padding: 0 10px;
            margin-top: 20px; 
        }
        .action-link {
            background: none; border: none; color: #333333;
            font-size: 0.95rem; cursor: pointer; padding: 10px; font-weight: 500;
        }
        .action-link:hover { color: #000000; }

        #home-screen {
            background-image: radial-gradient(circle, #e20074, #ffffff);
            color: #333333
        }
        .home-screen-content { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            padding: 55px 15px 15px; 
            width: 100%;
            overflow-y: auto; 
        }
        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 20px; 
            width: 100%;
            margin-bottom: auto; 
        }
        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
        }
        .app-icon img {
            width: 60px; 
            height: 60px;
            border-radius: 12px; 
            margin-bottom: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .app-icon span {
            font-size: 0.7rem; 
            color: #333333;
            max-width: 60px; 
            overflow-wrap: break-word; 
        }
        .dock {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: calc(130% - 20px); 
            max-width: 300px; 
            background-color: rgba(200, 200, 200, 0.3); 
            padding: 10px 5px;
            border-radius: 18px;
            margin: 10px auto 0; 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
        }

        .app-screen-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 55px; 
            color: #333333;
        }
        .app-screen-content h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Control Center */
        #control-center-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.3); 
            z-index: 40; 
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            display: flex; 
            justify-content: flex-end; 
        }
        #control-center-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        #control-center-panel {
            position: absolute;
            top: 0; 
            right: 0; 
            width: 80%; 
            max-width: 280px;
            height: auto; 
            min-height: 200px; 
            background-color: rgba(240, 240, 240, 0.9); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 0 0 0 20px; 
            box-shadow: -5px 5px 15px rgba(0,0,0,0.1);
            padding: 20px;
            padding-top: 50px; 
            transform: translateY(-100%); 
            transition: transform 0.3s ease-out;
            z-index: 41;
            display: flex;
            flex-direction: column;
        }
        #control-center-overlay.visible #control-center-panel {
            transform: translateY(0); 
        }
        .control-center-header {
            display: flex;
            justify-content: flex-end; 
            margin-bottom: 20px;
        }
        .control-center-power-btn {
            background: rgba(255,59,48,0.8); 
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .control-center-power-btn:hover {
            background: rgba(255,59,48,1);
        }
        .control-center-power-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* Power Off Screen */
        #power-off-screen {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.85); 
            z-index: 50; 
            display: none; 
            flex-direction: column;
            justify-content: space-between; 
            align-items: center;
            padding: 60px 20px 40px;
            color: white;
        }
        .power-off-slider-container {
            width: 100%;
            max-width: 300px;
            padding: 10px; /* Menší padding pro těsnější vzhled */
            background-color: rgba(255,255,255,0.1);
            border-radius: 30px;
            text-align: center;
            position: relative;
            height: 60px; /* Výška kontejneru slideru */
            display: flex;
            align-items: center;
        }
        .power-off-slider-knob {
            position: absolute;
            left: 5px; /* Počáteční pozice */
            top: 50%;
            transform: translateY(-50%);
            width: 50px; /* Velikost kolečka */
            height: 50px;
            background-color: #ff3b30; /* Červená barva */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 8px rgba(0,0,0,0.4);
            cursor: grab;
            z-index: 2; /* Nad textem */
        }
        .power-off-slider-knob svg {
            width: 28px;
            height: 28px;
            fill: white;
        }
        .power-off-slider-text {
            color: rgba(255,255,255,0.7);
            font-size: 1rem;
            pointer-events: none; 
            width: 100%; /* Aby text byl za kolečkem */
            text-align: center;
            z-index: 1; /* Pod kolečkem */
        }

        .power-off-cancel-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .power-off-cancel-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        .power-off-cancel-btn svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        /* Control Center */
        /* Control Center */
        #control-center-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.3); 
            z-index: 40; 
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            display: flex; 
            justify-content: flex-end; 
        }
        #control-center-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        #control-center-panel {
            position: absolute;
            top: 0; 
            right: 0; 
            width: 80%; 
            max-width: 280px;
            height: auto; 
            min-height: 200px; 
            background-color: rgba(240, 240, 240, 0.9); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 0 0 0 20px; 
            box-shadow: -5px 5px 15px rgba(0,0,0,0.1);
            padding: 20px;
            padding-top: 50px; 
            transform: translateY(-100%); 
            transition: transform 0.3s ease-out;
            z-index: 41;
            display: flex;
            flex-direction: column;
        }
        #control-center-overlay.visible #control-center-panel {
            transform: translateY(0); 
        }
        .control-center-header {
            display: flex;
            justify-content: flex-end; 
            margin-bottom: 20px;
        }
        .control-center-power-btn {
            background: rgba(255,59,48,0.8); 
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .control-center-power-btn:hover {
            background: rgba(255,59,48,1);
        }
        .control-center-power-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* Power Off Screen */
        #power-off-screen {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.85); 
            z-index: 50; 
            display: none; 
            flex-direction: column;
            justify-content: space-between; 
            align-items: center;
            padding: 60px 20px 40px;
            color: white;
        }
        .power-off-slider-container {
            width: 100%;
            max-width: 300px;
            padding: 10px; /* Menší padding pro těsnější vzhled */
            background-color: rgba(255,255,255,0.1);
            border-radius: 30px;
            text-align: center;
            position: relative;
            height: 60px; /* Výška kontejneru slideru */
            display: flex;
            align-items: center;
        }
        .power-off-slider-knob {
            position: absolute;
            left: 5px; /* Počáteční pozice */
            top: 50%;
            transform: translateY(-50%);
            width: 50px; /* Velikost kolečka */
            height: 50px;
            background-color: #ff3b30; /* Červená barva */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 8px rgba(0,0,0,0.4);
            cursor: grab;
            z-index: 2; /* Nad textem */
        }
        .power-off-slider-knob svg {
            width: 28px;
            height: 28px;
            fill: white;
        }
        .power-off-slider-text {
            color: rgba(255,255,255,0.7);
            font-size: 1rem;
            pointer-events: none; 
            width: 100%; /* Aby text byl za kolečkem */
            text-align: center;
            z-index: 1; /* Pod kolečkem */
        }

        .power-off-cancel-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .power-off-cancel-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        .power-off-cancel-btn svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        /* Fullscreen Shutdown Fade Overlay */
        #shutdown-fade-overlay {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0,0,0,0.7); 
            z-index: 9999; 
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #shutdown-fade-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .shutdown-message { 
            color: white;
            font-size: 1.2rem;
            padding: 20px;
            background-color: rgba(50,50,50,0.8);
            border-radius: 10px;
            text-align: center;
        }

        /* APLIKACE HODINY */
        .app-header {
            padding: 12px 16px;
            color: white;
        }
        .app-header h1 { /* Default styling for H1 in app-header */
            font-size: 34px;
            font-weight: 700;
            margin-top: 44px; /* Space for status bar, if H1 is the main title */
            color: #ffffff;
        }
        .app-content {
            flex-grow: 1;
            overflow-y: auto;
            color: #ffffff; /* Default text color for app content */
            background-color: #000000; /* App background */
        }
        .tab-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 83px; /* iOS tab bar height with home indicator area */
            background-color: #1c1c1e; /* Slightly lighter than screen for depth */
            border-top: 0.5px solid #38383a; /* Subtle top border */
            padding-bottom: 34px; /* Space for home indicator */
        }
        .tab-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #8e8e93; /* Inactive tab color */
            font-size: 10px;
            flex-grow: 1;
            padding-top: 6px;
            cursor: pointer;
        }
        .tab-button.active {
            color: #ff9500; /* Orange for active tab */
        }
        .tab-button svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }
        /* Common list item styling */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid #38383a;
            font-size: 17px;
            color: #ffffff; /* Ensure default list item text is white */
        }
        .list-item:last-child {
            border-bottom: none;
        }
        /* Alarm toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 51px;
            height: 31px;
            flex-shrink: 0; /* Prevent toggle from shrinking */
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #39393d; /* Off state */
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 27px;
            width: 27px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #34c759; /* Green for on state */
        }
        input:checked + .slider:before {
            transform: translateX(20px);
        }
        /* Stopwatch/Timer buttons */
        .control-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .control-button-start { background-color: rgba(48, 128, 52, 0.3); color: #30d158; } /* Green */
        .control-button-stop { background-color: rgba(255, 55, 45, 0.3); color: #ff453a; } /* Red */
        .control-button-lap, .control-button-reset, .control-button-cancel { background-color: #333333; color: white; }
        .control-button-pause { background-color: rgba(255, 149, 0, 0.4); color: #ff9500; } /* Orange */

        .timer-picker-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        .timer-picker-column {
            width: 70px;
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .timer-picker-column::-webkit-scrollbar { display: none; }
        .timer-picker-item {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: #8e8e93;
            scroll-snap-align: center;
            scroll-snap-stop: always;
        }
        .timer-selection-indicator {
            position: absolute;
            top: 50%;
            left: 10px; right: 10px;
            transform: translateY(-50%);
            height: 40px;
            border-top: 1px solid #555;
            border-bottom: 1px solid #555;
            pointer-events: none;
            z-index: 1;
        }
        .timer-picker-item.selected { color: #ffffff; font-weight: 600; }

        .delete-button {
            background-color: #ff3b30; color: white; border: none; border-radius: 50%;
            width: 30px; height: 30px; font-size: 20px; line-height: 30px;
            text-align: center; cursor: pointer; margin-right: 10px; display: none;
        }
        .editing .delete-button { display: inline-block; }

        .lap-item {
            display: flex; justify-content: space-between; padding: 8px 16px;
            font-size: 17px; color: #ffffff; border-bottom: 0.5px solid #38383a;
        }
        .lap-item:last-child { border-bottom: none; }
        .lap-number { color: #8e8e93; }
        .text-gray-400 { color: #8e8e93; } /* Custom utility for secondary text */
        .text-white { color: #ffffff; }
    </style>
</head>
<body>

    <div id="iphone-device">
        <div id="volume-up-button" class="iphone-side-button volume-button-up" aria-label="Zvýšit hlasitost"></div>
        <div id="volume-down-button" class="iphone-side-button volume-button-down" aria-label="Snížit hlasitost"></div>
        <div id="power-button" class="iphone-side-button side-button-power" aria-label="Zamknout/Odemknout"></div>

        <div id="simulated-screen">
            <div class="dynamic-island"></div> 

            <div id="volume-indicator-overlay">
                <div id="volume-level-bar-container">
                    <div id="volume-level-bar"></div>
                </div>
            </div>

            <div id="control-center-overlay">
                <div id="control-center-panel">
                    <div class="control-center-header">
                        <button id="control-center-power-off-btn" class="control-center-power-btn" aria-label="Vypnout">
                            <svg viewBox="0 0 20 20"><path d="M9.99 2.5a.75.75 0 00-1.06 0L6.22 5.22a.75.75 0 001.06 1.06L9.25 4.31V10a.75.75 0 001.5 0V4.31l1.97 1.97a.75.75 0 001.06-1.06l-2.72-2.72zM5 10a.75.75 0 01.75-.75h8.5a.75.75 0 010 1.5H5.75A.75.75 0 015 10zM3.938 7.5H3.5a1.5 1.5 0 00-1.5 1.5v6A1.5 1.5 0 003.5 16.5h13a1.5 1.5 0 001.5-1.5v-6a1.5 1.5 0 00-1.5-1.5h-.438c.22-.612.31-1.254.266-1.898A6.501 6.501 0 0010 0a6.5 6.5 0 00-6.328 5.602c-.044.644.047 1.286.266 1.898zM10 1.5a5 5 0 014.832 4.09A5.003 5.003 0 0110 10.5a5.003 5.003 0 01-4.832-4.91A5 5 0 0110 1.5z"></path></svg>
                        </button>
                    </div>
                    <p style="color: #555; text-align: center; margin-top: 20px;">Ovládací Centrum</p>
                </div>
            </div>

            <div id="power-off-screen" class="screen-view"> 
                <div class="power-off-slider-container" id="power-off-slider-container">
                    <div class="power-off-slider-knob" id="power-off-slider-knob">
                        <svg viewBox="0 0 20 20" fill="currentColor" style="width: 24px; height: 24px;"> 
                            <path fill-rule="evenodd" d="M9.99 2.5a.75.75 0 00-1.06 0L6.22 5.22a.75.75 0 001.06 1.06L9.25 4.31V10a.75.75 0 001.5 0V4.31l1.97 1.97a.75.75 0 001.06-1.06l-2.72-2.72zM5 10a.75.75 0 01.75-.75h8.5a.75.75 0 010 1.5H5.75A.75.75 0 015 10zM3.938 7.5H3.5a1.5 1.5 0 00-1.5 1.5v6A1.5 1.5 0 003.5 16.5h13a1.5 1.5 0 001.5-1.5v-6a1.5 1.5 0 00-1.5-1.5h-.438c.22-.612.31-1.254.266-1.898A6.501 6.501 0 0010 0a6.5 6.5 0 00-6.328 5.602c-.044.644.047 1.286.266 1.898zM10 1.5a5 5 0 014.832 4.09A5.003 5.003 0 0110 10.5a5.003 5.003 0 01-4.832-4.91A5 5 0 0110 1.5z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <span class="power-off-slider-text">Vypněte přejetím</span>
                </div>
                </div>


            <div id="lock-screen" class="screen-view active">
                <div class="status-bar">
                    <span class="operator-name">T-Mobile CZ</span>
                    <div class="icons">
                        <svg viewBox="0 0 48 38" class="ios-signal-icon"><rect x="2" y="26" width="7" height="9" rx="1.5"></rect><rect x="11" y="19" width="7" height="16" rx="1.5"></rect><rect x="20" y="12" width="7" height="23" rx="1.5"></rect><rect x="29" y="5" width="7" height="30" rx="1.5"></rect></svg>
                        <svg viewBox="0 0 26 16" class="ios-5g-icon"><text x="0" y="12.5" font-size="13">5G</text></svg>
                        <svg viewBox="0 0 30 18" class="ios-battery-icon"><rect x="1" y="2.5" width="22" height="11" rx="2" ry="2" stroke-width="1.5" fill="none" stroke="#333333"/><rect x="2.5" y="4" width="15.5" height="8" fill="#333333" rx="1" ry="1"/><rect x="24" y="5.5" width="2" height="5" rx="0.5" ry="0.5" fill="#333333"/></svg>
                    </div>
                </div>
                <div class="lock-screen-content-wrapper">
                    <div class="lock-screen-top-info">
                        <div id="lock-screen-date" class="current-date"></div>
                        <div id="lock-screen-time-large" class="current-time-large"></div>
                    </div>
                    <div class="lock-screen-bottom-controls">
                        <div class="lock-screen-shortcuts">
                            <button id="flashlight-btn" class="shortcut-button" aria-label="Svítilna">
                                <img src="https://i.ibb.co/R4QvChNg/svitilna.png" alt="svítilna">
                            </button>
                            <button id="camera-btn" class="shortcut-button" aria-label="Fotoaparát">
                                <img src="https://i.ibb.co/dJKGtySg/fotoaparat.png" alt="fotoaparát">
                            </button>
                        </div>
                    </div>
                </div>
                 <div class="home-indicator-area" id="home-indicator-interaction-area"> 
                    <div class="home-indicator-bar"></div>
                </div>
            </div>

            <div id="passcode-screen" class="screen-view">
                <div class="status-bar">
                    <span class="operator-name">T-Mobile CZ</span>
                     <div class="icons">
                        <svg viewBox="0 0 48 38" class="ios-signal-icon"><rect x="2" y="26" width="7" height="9" rx="1.5"></rect><rect x="11" y="19" width="7" height="16" rx="1.5"></rect><rect x="20" y="12" width="7" height="23" rx="1.5"></rect><rect x="29" y="5" width="7" height="30" rx="1.5"></rect></svg>
                        <svg viewBox="0 0 26 16" class="ios-5g-icon"><text x="0" y="12.5" font-size="13">5G</text></svg>
                        <svg viewBox="0 0 30 18" class="ios-battery-icon"><rect x="1" y="2.5" width="22" height="11" rx="2" ry="2" stroke-width="1.5" fill="none" stroke="#333333"/><rect x="2.5" y="4" width="15.5" height="8" fill="#333333" rx="1" ry="1"/><rect x="24" y="5.5" width="2" height="5" rx="0.5" ry="0.5" fill="#333333"/></svg>
                    </div>
                </div>
                <div class="passcode-screen-wrapper">
                    <div class="passcode-prompt">Zadejte kód</div>
                    <div class="passcode-circles">
                        <div class="circle"></div><div class="circle"></div><div class="circle"></div>
                        <div class="circle"></div><div class="circle"></div><div class="circle"></div>
                    </div>
                    <div class="keypad">
                        <button class="keypad-button" data-value="1"><span class="digit">1</span><span class="letters">&nbsp;</span></button>
                        <button class="keypad-button" data-value="2"><span class="digit">2</span><span class="letters">ABC</span></button>
                        <button class="keypad-button" data-value="3"><span class="digit">3</span><span class="letters">DEF</span></button>
                        <button class="keypad-button" data-value="4"><span class="digit">4</span><span class="letters">GHI</span></button>
                        <button class="keypad-button" data-value="5"><span class="digit">5</span><span class="letters">JKL</span></button>
                        <button class="keypad-button" data-value="6"><span class="digit">6</span><span class="letters">MNO</span></button>
                        <button class="keypad-button" data-value="7"><span class="digit">7</span><span class="letters">PQRS</span></button>
                        <button class="keypad-button" data-value="8"><span class="digit">8</span><span class="letters">TUV</span></button>
                        <button class="keypad-button" data-value="9"><span class="digit">9</span><span class="letters">WXYZ</span></button>
                        <div class="keypad-button utility" style="visibility: hidden;"></div>
                        <button class="keypad-button" data-value="0"><span class="digit">0</span><span class="letters">&nbsp;</span></button>
                        <div class="keypad-button utility" style="visibility: hidden;"></div>
                    </div>
                    <div class="passcode-actions">
                        <button id="emergency-btn" class="action-link">Krizová situace</button>
                        <button id="cancel-passcode-btn" class="action-link">Zrušit</button>
                    </div>
                </div>
                <div class="home-indicator-area" id="passcode-home-indicator"> 
                    <div class="home-indicator-bar"></div>
                </div>
            </div>

            <div id="home-screen" class="screen-view">
                 <div class="status-bar">
                    <span class="status-bar-time" id="home-screen-status-time"></span> 
                     <div class="icons">
                        <svg viewBox="0 0 48 38" class="ios-signal-icon"><rect x="2" y="26" width="7" height="9" rx="1.5"></rect><rect x="11" y="19" width="7" height="16" rx="1.5"></rect><rect x="20" y="12" width="7" height="23" rx="1.5"></rect><rect x="29" y="5" width="7" height="30" rx="1.5"></rect></svg>
                        <svg viewBox="0 0 26 16" class="ios-5g-icon"><text x="0" y="12.5" font-size="13">5G</text></svg>
                        <svg viewBox="0 0 30 18" class="ios-battery-icon"><rect x="1" y="2.5" width="22" height="11" rx="2" ry="2" stroke-width="1.5" fill="none" stroke="#333333"/><rect x="2.5" y="4" width="15.5" height="8" fill="#333333" rx="1" ry="1"/><rect x="24" y="5.5" width="2" height="5" rx="0.5" ry="0.5" fill="#333333"/></svg>
                    </div>
                </div>
                <div class="home-screen-content">
                    <div class="app-grid" id="main-app-grid">
                        <div id="app-main-content" class="flex-grow flex flex-col">
                </div>
                        </div>
                    <div class="dock" id="dock-app-grid">
                        </div>
                </div>
                            <!-- APLIKACE HODINY -->
            <div class="tab-bar">
                <button class="tab-button active" data-tab="world-clock">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zM12 6a1 1 0 00-1 1v4.586l-2.707 2.707 1.414 1.414L12 12.414V7a1 1 0 00-1-1zm5.707.293-3-3a1 1 0 10-1.414 1.414L14.586 7H9.414l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 9h5.172l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414z"/></svg>
                    <span>Světový čas</span>
                </button>
                <button class="tab-button" data-tab="alarms">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/><path d="M13 7h-2v5.414l3.293 3.293 1.414-1.414L13 11.586z"/></svg>
                    <span>Budíky</span>
                </button>
                <button class="tab-button" data-tab="stopwatch">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c-5.514 0-10 4.486-10 10s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm1-13h-2v6l5 3 1-1.732-4-2.42V7zM7 1h10v2H7z"/></svg>
                    <span>Stopky</span>
                </button>
                <button class="tab-button" data-tab="timer">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6c-1.103 0-2 .897-2 2v16c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zM6 4h12v2H6V4zm0 16v-9h12v9H6zm7-6.5c0-.276-.224-.5-.5-.5h-3c-.276 0-.5.224-.5.5s.224.5.5.5h3c.276 0 .5-.224.5-.5z"/></svg>
                    <span>Minutka</span>
                </button>
            </div>
                <div class="home-indicator-area" id="home-screen-home-indicator"> 
                    <div class="home-indicator-bar"></div>
                </div>
            </div>
            
        </div> </div> 
        <script>
        const lockScreen = document.getElementById('lock-screen');
        const passcodeScreen = document.getElementById('passcode-screen');
        const homeScreen = document.getElementById('home-screen');
        const simulatedScreen = document.getElementById('simulated-screen'); 

        const homeIndicatorLock = document.getElementById('home-indicator-interaction-area');
        const homeIndicatorPasscode = document.getElementById('passcode-home-indicator');
        const homeIndicatorHome = document.getElementById('home-screen-home-indicator');

        const powerButton = document.getElementById('power-button');
        const volumeUpButton = document.getElementById('volume-up-button');
        const volumeDownButton = document.getElementById('volume-down-button');

        const volumeIndicatorOverlay = document.getElementById('volume-indicator-overlay');
        const volumeLevelBar = document.getElementById('volume-level-bar');
        
        const cancelPasscodeBtn = document.getElementById('cancel-passcode-btn');
        const emergencyBtn = document.getElementById('emergency-btn');
        const keypadButtons = document.querySelectorAll('.keypad-button[data-value]');
        const passcodeCirclesContainer = document.querySelector('.passcode-circles');
        const passcodeCircles = passcodeCirclesContainer.querySelectorAll('.circle');

        const lockScreenTimeLargeEl = document.getElementById('lock-screen-time-large');
        const lockScreenDateEl = document.getElementById('lock-screen-date');
        const homeScreenStatusTimeEl = document.getElementById('home-screen-status-time'); 

        const flashlightBtn = document.getElementById('flashlight-btn');
        const cameraBtn = document.getElementById('camera-btn');

        const controlCenterOverlay = document.getElementById('control-center-overlay');
        const controlCenterPanel = document.getElementById('control-center-panel');
        const controlCenterPowerOffBtn = document.getElementById('control-center-power-off-btn');
        const powerOffScreen = document.getElementById('power-off-screen');
        const powerOffSliderContainer = document.getElementById('power-off-slider-container'); 
        const powerOffSliderKnob = document.getElementById('power-off-slider-knob'); 
        // const cancelPowerOffBtn = document.getElementById('cancel-power-off-btn'); // Odebráno

        const shutdownFadeOverlay = document.getElementById('shutdown-fade-overlay');


        let currentPasscode = "";
        const CORRECT_PASSCODE = "320010";
        let flashlightActive = false;

        let currentVolume = 50; 
        const volumeStep = 10;
        let volumeIndicatorTimeout;
        let controlCenterVisible = false;

        let isDraggingSlider = false;
        let sliderStartX;
        let knobStartLeft;
        const sliderThresholdPercentage = 0.7; 


        const mainApps = [
            { name: "Hodiny", icon: "https://i.ibb.co/677118rf/hodiny.png", id: "clock" },
            { name: "Kalendář", icon: "https://i.ibb.co/gF9QBk9C/kalendar.png", id: "calendar" },
            { name: "Poznámky", icon: "https://i.ibb.co/vxYKm2mF/poznamky.png", id: "notes" },
            { name: "Kalkulačka", icon: "https://i.ibb.co/1G6WWy29/kalkulacka.png", id: "calculator" },
            { name: "Fotoaparát", icon: "https://i.ibb.co/0jv2Pp7R/fotoaparat.png", id: "camera-app" },
            { name: "Fotky", icon: "https://i.ibb.co/QvypZ4D7/fotky.png", id: "photos" },
            { name: "Soubory", icon: "https://i.ibb.co/Swp0747n/soubory.png", id: "files" },
            { name: "YouTube", icon: "https://i.ibb.co/Vb3HwFf/youtube.png", id: "youtube" },
            { name: "Facebook", icon: "https://i.ibb.co/S4N4r9ZQ/facebook.png", id: "facebook" },
            { name: "Messenger", icon: "https://i.ibb.co/cSXbVCKR/messenger.png", id: "messenger" },
            { name: "Instagram", icon: "https://i.ibb.co/jvFnrXjT/instagram.png", id: "instagram" },
            { name: "WhatsApp", icon: "https://i.ibb.co/B25wc64p/whatsapp.png", id: "whatsapp" },
            { name: "Safari", icon: "https://i.ibb.co/mrDL8Zxr/safari.png", id: "safari" },
            { name: "FaceTime", icon: "https://i.ibb.co/1fTXttXH/facetime.png", id: "facetime" },
            { name: "Najít", icon: "https://i.ibb.co/PGVtyw0N/najit.png", id: "findmy" },
            { name: "Mapy", icon: "https://i.ibb.co/fzhY0b68/mapy.png", id: "maps" },
            { name: "Hesla", icon: "https://i.ibb.co/q3WKBDf9/hesla.png", id: "passwords" },
            { name: "AppStore", icon: "https://i.ibb.co/sdNRMg1K/appstore.png", id: "appstore" },
            { name: "Nastavení", icon: "https://i.ibb.co/fVY7kGFx/nastaveni.png", id: "settings" }
        ];

        const dockApps = [
            { name: "", icon: "https://i.ibb.co/GQCbvY38/kontakty.png", id: "contacts" },
            { name: "", icon: "https://i.ibb.co/d4ZmbMbq/telefon.png", id: "phone" },
            { name: "", icon: "https://i.ibb.co/wjcDDqx/zpravy.png", id: "messages" },
            { name: "", icon: "https://i.ibb.co/JF8zxDXJ/mail.png", id: "mail" }
        ];

        function createAppScreen(app) {
            const appScreenId = `app-${app.id}-screen`;
            if (document.getElementById(appScreenId)) {
                return appScreenId;
            }

            const appScreenDiv = document.createElement('div');
            appScreenDiv.id = appScreenId;
            appScreenDiv.classList.add('screen-view', 'app-screen'); 
            appScreenDiv.style.backgroundColor = '#f8f8f8'; 

            const statusBarHtml = `
                <div class="status-bar" data-app-screen-id="${appScreenId}"> <span class="status-bar-time" id="app-${app.id}-status-time"></span>
                    <div class="icons">
                        <svg viewBox="0 0 48 38" class="ios-signal-icon"><rect x="2" y="26" width="7" height="9" rx="1.5"></rect><rect x="11" y="19" width="7" height="16" rx="1.5"></rect><rect x="20" y="12" width="7" height="23" rx="1.5"></rect><rect x="29" y="5" width="7" height="30" rx="1.5"></rect></svg>
                        <svg viewBox="0 0 26 16" class="ios-5g-icon"><text x="0" y="12.5" font-size="13">5G</text></svg>
                        <svg viewBox="0 0 30 18" class="ios-battery-icon"><rect x="1" y="2.5" width="22" height="11" rx="2" ry="2" stroke-width="1.5" fill="none" stroke="#333333"/><rect x="2.5" y="4" width="15.5" height="8" fill="#333333" rx="1" ry="1"/><rect x="24" y="5.5" width="2" height="5" rx="0.5" ry="0.5" fill="#333333"/></svg>
                    </div>
                </div>`;
            
            const contentHtml = `
                <div class="app-screen-content">
                    <h2>${app.name}</h2>
                    <p>Toto je obrazovka aplikace ${app.name}.</p>
                </div>`;

            const homeIndicatorHtml = `
                <div class="home-indicator-area app-home-indicator" data-app-id="${app.id}">
                    <div class="home-indicator-bar"></div>
                </div>`;
            
            appScreenDiv.innerHTML = statusBarHtml + contentHtml + homeIndicatorHtml;
            simulatedScreen.appendChild(appScreenDiv);

            const appStatusBar = appScreenDiv.querySelector('.status-bar');
            if (appStatusBar) {
                appStatusBar.addEventListener('click', toggleControlCenter);
            }
            return appScreenId;
        }


        function populateAppGrid(apps, gridElementId) {
            const grid = document.getElementById(gridElementId);
            if (!grid) return;

            apps.forEach(app => {
                const appScreenId = createAppScreen(app); 

                const iconDiv = document.createElement('div');
                iconDiv.classList.add('app-icon');
                iconDiv.setAttribute('data-app', appScreenId); 
                
                const img = document.createElement('img');
                img.src = app.icon;
                img.alt = `Ikona ${app.name}`;
                img.onerror = function() { this.src='https://placehold.co/60x60/e0e0e0/757575?text=App'; this.alt='Placeholder ikona aplikace';};


                const span = document.createElement('span');
                span.textContent = app.name;

                iconDiv.appendChild(img);
                iconDiv.appendChild(span);
                grid.appendChild(iconDiv);

                iconDiv.addEventListener('click', () => {
                    const targetScreenId = iconDiv.getAttribute('data-app');
                    const targetScreen = document.getElementById(targetScreenId);
                    if (targetScreen) {
                        showScreen(targetScreen);
                    }
                });
            });
        }
        
        function addHomeIndicatorListenersForAppScreens() {
            const appHomeIndicators = document.querySelectorAll('.app-home-indicator');
            appHomeIndicators.forEach(indicator => {
                const newIndicator = indicator.cloneNode(true);
                indicator.parentNode.replaceChild(newIndicator, indicator);
                newIndicator.addEventListener('click', () => {
                    showScreen(homeScreen);
                });
            });
        }


        function updateDateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const timeString = `${hours}:${minutes}`; 
            const optionsDate = { weekday: 'long', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('cs-CZ', optionsDate);

            if (lockScreenTimeLargeEl) {
                lockScreenTimeLargeEl.textContent = timeString; 
            }
            if (lockScreenDateEl) {
                lockScreenDateEl.textContent = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            }

            if (homeScreenStatusTimeEl && homeScreen.classList.contains('active')) {
                homeScreenStatusTimeEl.textContent = timeString;
            }

            const activeAppScreen = document.querySelector('.app-screen.active');
            if (activeAppScreen) {
                const appTimeEl = activeAppScreen.querySelector('.status-bar-time');
                if (appTimeEl) {
                    appTimeEl.textContent = timeString;
                }
            }
        }

        function showScreen(screenElement) {
            document.querySelectorAll('.screen-view').forEach(s => {
                s.classList.remove('active');
                if (s.id !== 'power-off-screen') { 
                    s.style.display = 'none';
                }
            });
            if (screenElement) { 
                 screenElement.classList.add('active');
                 if (screenElement.id !== 'power-off-screen') {
                    screenElement.style.display = 'flex';
                 }
            }
            if (screenElement && screenElement.id === 'power-off-screen') {
                powerOffScreen.style.display = 'flex';
            } else if (powerOffScreen && powerOffScreen.style.display === 'flex' && screenElement !== powerOffScreen) {
                powerOffScreen.style.display = 'none';
            }

            updateDateTime(); 
        }

        function resetPasscodeEntry() {
            currentPasscode = "";
            passcodeCircles.forEach(circle => circle.classList.remove('filled'));
        }

        function updatePasscodeCircles() {
            passcodeCircles.forEach((circle, index) => {
                circle.classList.toggle('filled', index < currentPasscode.length);
            });
        }

        function handlePasscodeDigit(digit) {
            if (currentPasscode.length < 6) {
                currentPasscode += digit;
                updatePasscodeCircles();
                if (currentPasscode.length === 6) {
                    checkPasscode();
                }
            }
        }

        function checkPasscode() {
            if (currentPasscode === CORRECT_PASSCODE) {
                setTimeout(() => {
                    showScreen(homeScreen);
                    resetPasscodeEntry();
                }, 200);
            } else {
                passcodeCirclesContainer.classList.add('shake');
                passcodeCircles.forEach(c => c.style.borderColor = '#cc0000');

                setTimeout(() => {
                    passcodeCirclesContainer.classList.remove('shake');
                    resetPasscodeEntry();
                    passcodeCircles.forEach(c => c.style.borderColor = 'rgba(51, 51, 51, 0.6)');
                }, 600);
            }
        }

        function updateVolumeIndicatorDisplay() {
            if (volumeLevelBar) {
                volumeLevelBar.style.height = `${currentVolume}%`;
            }
        }

        function showVolumeIndicator() {
            if (volumeIndicatorOverlay) {
                volumeIndicatorOverlay.classList.remove('hidden-animation'); 
                volumeIndicatorOverlay.classList.add('visible');
                updateVolumeIndicatorDisplay();

                clearTimeout(volumeIndicatorTimeout); 
                volumeIndicatorTimeout = setTimeout(() => {
                    volumeIndicatorOverlay.classList.add('hidden-animation'); 
                    setTimeout(() => { 
                         volumeIndicatorOverlay.classList.remove('visible');
                    }, 300); 
                }, 2000); 
            }
        }
        
        function toggleControlCenter() {
            const currentActiveScreen = document.querySelector('.screen-view.active');
            if (currentActiveScreen && (currentActiveScreen.id === 'home-screen' || currentActiveScreen.classList.contains('app-screen'))) {
                controlCenterVisible = !controlCenterVisible;
                if (controlCenterOverlay) {
                    controlCenterOverlay.classList.toggle('visible', controlCenterVisible);
                }
            }
        }
        
        function handleSliderDragStart(e) {
            isDraggingSlider = true;
            if (powerOffSliderKnob) powerOffSliderKnob.style.cursor = 'grabbing';
            sliderStartX = e.clientX || (e.touches && e.touches[0].clientX);
            if (powerOffSliderKnob) knobStartLeft = powerOffSliderKnob.offsetLeft;
            
            document.addEventListener('mousemove', handleSliderDragMove);
            document.addEventListener('touchmove', handleSliderDragMove, { passive: false }); 
            document.addEventListener('mouseup', handleSliderDragEnd);
            document.addEventListener('touchend', handleSliderDragEnd);
            if (e.touches && e.preventDefault) e.preventDefault(); 
        }

        function handleSliderDragMove(e) {
            if (!isDraggingSlider) return;
            if (e.preventDefault) e.preventDefault(); 

            const currentX = e.clientX || (e.touches && e.touches[0].clientX);
            const deltaX = currentX - sliderStartX;
            let newLeft = knobStartLeft + deltaX;

            const containerRect = powerOffSliderContainer.getBoundingClientRect();
            const knobRect = powerOffSliderKnob.getBoundingClientRect();
            
            const minLeft = 0; 
            const maxLeft = containerRect.width - knobRect.width - (2 * 5); 

            newLeft = Math.max(minLeft, Math.min(newLeft, maxLeft));
            if (powerOffSliderKnob) powerOffSliderKnob.style.left = `${newLeft}px`;
        }

        function handleSliderDragEnd() {
            if (!isDraggingSlider) return;
            isDraggingSlider = false;
            if (powerOffSliderKnob) powerOffSliderKnob.style.cursor = 'grab';
            document.removeEventListener('mousemove', handleSliderDragMove);
            document.removeEventListener('touchmove', handleSliderDragMove);
            document.removeEventListener('mouseup', handleSliderDragEnd);
            document.removeEventListener('touchend', handleSliderDragEnd);

            const containerRect = powerOffSliderContainer.getBoundingClientRect();
            const knobRect = powerOffSliderKnob.getBoundingClientRect();
            const currentKnobPosition = powerOffSliderKnob.offsetLeft;
            const activationThreshold = (containerRect.width - knobRect.width - 10) * sliderThresholdPercentage;


            if (currentKnobPosition >= activationThreshold) {
                console.log("Power off slider activated - initiating shutdown sequence");
                
                const messageBox = document.createElement('div');
                messageBox.className = 'shutdown-message';
                messageBox.textContent = "Čekejte, prosím. Simulátor se vypíná.";
                
                if (shutdownFadeOverlay) {
                    shutdownFadeOverlay.innerHTML = ''; 
                    shutdownFadeOverlay.appendChild(messageBox);
                    shutdownFadeOverlay.classList.add('visible');
                }
                
                setTimeout(() => {
                    // Zde by se normálně jen čekalo, zpráva je již v overlayi
                    setTimeout(() => {
                        console.log("Redirecting to index.html");
                        window.location.href = 'index.html'; 
                    }, 5000); // Čekání 2s s černým overlayem
                }, 100); // Krátká prodleva pro zobrazení zprávy

            } else {
                if (powerOffSliderKnob) {
                    powerOffSliderKnob.style.transition = 'left 0.3s ease-out';
                    powerOffSliderKnob.style.left = '5px'; 
                    setTimeout(() => {
                        if (powerOffSliderKnob) powerOffSliderKnob.style.transition = ''; 
                    }, 3000);
                }
            }
        }
        
        if (powerOffSliderKnob) {
            powerOffSliderKnob.addEventListener('mousedown', handleSliderDragStart);
            powerOffSliderKnob.addEventListener('touchstart', handleSliderDragStart, { passive: false });
        }

        if (powerButton) {
            powerButton.addEventListener('click', () => {
                console.log("Power button clicked");
                showScreen(lockScreen);
                resetPasscodeEntry(); 
            });
        }

        if (volumeUpButton) {
            volumeUpButton.addEventListener('click', () => {
                currentVolume = Math.min(100, currentVolume + volumeStep);
                console.log("Volume Up: " + currentVolume);
                showVolumeIndicator();
            });
        }

        if (volumeDownButton) {
            volumeDownButton.addEventListener('click', () => {
                currentVolume = Math.max(0, currentVolume - volumeStep);
                console.log("Volume Down: " + currentVolume);
                showVolumeIndicator();
            });
        }

        if (homeIndicatorLock) {
            homeIndicatorLock.addEventListener('click', () => {
                showScreen(passcodeScreen);
                resetPasscodeEntry();
            });
        }
        if (homeIndicatorPasscode) {
             homeIndicatorPasscode.addEventListener('click', () => {
                 showScreen(lockScreen); 
                 resetPasscodeEntry();
             });
        }
        if (homeIndicatorHome) {
            homeIndicatorHome.addEventListener('click', () => {
                 showScreen(homeScreen);
            });
        }

        document.querySelectorAll('.status-bar').forEach(sb => {
            sb.addEventListener('click', (event) => {
                const clickedOnIcon = event.target.closest('.icons');
                const currentActiveScreen = document.querySelector('.screen-view.active');
                if (currentActiveScreen && (currentActiveScreen.id === 'home-screen' || currentActiveScreen.classList.contains('app-screen')) &&
                    (!powerOffScreen || powerOffScreen.style.display !== 'flex') && 
                    !clickedOnIcon) {
                    toggleControlCenter();
                }
            });
        });

        if(controlCenterOverlay) {
            controlCenterOverlay.addEventListener('click', (event) => {
                if (event.target === controlCenterOverlay) {
                    toggleControlCenter();
                }
            });
        }


        if (controlCenterPowerOffBtn) {
            controlCenterPowerOffBtn.addEventListener('click', () => {
                if (controlCenterOverlay) controlCenterOverlay.classList.remove('visible');
                controlCenterVisible = false;
                if (powerOffScreen) {
                    powerOffScreen.style.display = 'flex'; 
                    powerOffScreen.classList.add('active'); 
                    if(powerOffSliderKnob) powerOffSliderKnob.style.left = '5px';
                }
            });
        }

        // Odebrán listener pro cancelPowerOffBtn, protože tlačítko bylo odstraněno

        if (cancelPasscodeBtn) {
            cancelPasscodeBtn.addEventListener('click', () => {
                showScreen(lockScreen);
                resetPasscodeEntry();
            });
        }

        if (emergencyBtn) {
            emergencyBtn.addEventListener('click', () => {
                console.log("Krizová situace aktivována");
                const existingMessageBox = document.getElementById('custom-message-box');
                if (existingMessageBox) existingMessageBox.remove();

                const messageBox = document.createElement('div');
                messageBox.id = 'custom-message-box';
                messageBox.style.cssText = 'position: fixed; left: 50%; top: 30%; transform: translate(-50%, -50%); background-color: rgba(50,50,50,0.9); color: white; padding: 25px; border-radius: 12px; z-index: 1001; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 1rem;';
                messageBox.innerHTML = 'Funkce Krizová situace není v tomto simulátoru plně implementována.<br><button id="close-alert-btn" style="padding: 8px 15px; margin-top: 15px; background-color: #007aff; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 0.9rem;">OK</button>';
                document.body.appendChild(messageBox);
                document.getElementById('close-alert-btn').onclick = () => messageBox.remove();
            });
        }

        keypadButtons.forEach(button => {
            button.addEventListener('click', () => {
                const value = button.dataset.value;
                if (value) handlePasscodeDigit(value);
            });
        });

        if (flashlightBtn) {
            flashlightBtn.addEventListener('click', () => {
                flashlightActive = !flashlightActive;
                flashlightBtn.classList.toggle('active', flashlightActive);
                console.log(flashlightActive ? "Svítilna zapnuta" : "Svítilna vypnuta");
            });
        }

        if (cameraBtn) {
            cameraBtn.addEventListener('click', () => {
                console.log("Fotoaparát aktivován (simulace)");
                const existingMessageBox = document.getElementById('custom-message-box');
                if (existingMessageBox) existingMessageBox.remove();
                const messageBox = document.createElement('div');
                messageBox.id = 'custom-message-box';
                messageBox.style.cssText = 'position: fixed; left: 50%; top: 30%; transform: translate(-50%, -50%); background-color: rgba(50,50,50,0.9); color: white; padding: 25px; border-radius: 12px; z-index: 1001; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 1rem;';
                messageBox.innerHTML = 'Fotoaparát není v tomto simulátoru implementován.<br>Otevírám obrazovku pro zadání kódu.<br><button id="close-alert-btn" style="padding: 8px 15px; margin-top: 15px; background-color: #007aff; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 0.9rem;">OK</button>';
                document.body.appendChild(messageBox);
                document.getElementById('close-alert-btn').onclick = () => {
                    messageBox.remove();
                    showScreen(passcodeScreen);
                    resetPasscodeEntry();
                };
            });
        }

        // Inicializace
        populateAppGrid(mainApps, 'main-app-grid');
        populateAppGrid(dockApps, 'dock-app-grid');
        addHomeIndicatorListenersForAppScreens(); 

        showScreen(lockScreen); 
        setInterval(updateDateTime, 1000); 

        // APP Hodiny
            const appMainContent = document.getElementById('app-main-content');
        const tabButtons = document.querySelectorAll('.tab-button');
        const statusBarTime = document.getElementById('status-bar-time');

        let alarms = [
            { id: Date.now() + 1, time: "06:45", label: "I. budík", repeat: "Každý všední den", enabled: true, days: [1,2,3,4,5] },
            { id: Date.now() + 2, time: "07:00", label: "II. budík", repeat: "Každý den", enabled: true, days: [0,1,2,3,4,5,6] },
            { id: Date.now() + 3, time: "07:15", label: "III. budík", repeat: "Každý víkend", enabled: true, days: [0,6] }
        ];
        let isEditingAlarms = false;

        // Stopwatch state
        let stopwatchInterval;
        let stopwatchTime = 0; // in centiseconds
        let stopwatchRunning = false;
        let stopwatchLaps = [];

        // Timer state
        let timerInterval;
        let timerTotalSeconds = 0;
        let timerRemainingSeconds = 0;
        let timerRunning = false;
        const timerPickers = {};

        function updateStatusBarTime() {
            const now = new Date();
            statusBarTime.textContent = now.toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateStatusBarTime, 1000);
        updateStatusBarTime();


        function renderWorldClock() {
            const timezones = [
                { name: 'Praha', tz: 'Europe/Prague' },
                { name: 'Las Vegas', tz: 'America/Los_Angeles' },
                { name: 'Hong Kong', tz: 'Asia/Hong_Kong' },
                { name: 'Venezuela', tz: 'America/Caracas' },
                { name: 'Nový Zéland', tz: 'Pacific/Auckland' }
            ];
            // Use the .app-header h1 CSS rule for consistent title spacing
            let content = `<div class="app-header"><h1 class="text-white">Světový čas</h1></div><div class="divide-y divide-gray-700">`;
            const now = new Date();

            timezones.forEach(city => {
                const cityTime = new Date(now.toLocaleString('en-US', { timeZone: city.tz }));
                const pragueTime = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Prague' }));
                
                let dayDiffText = "Dnes";
                if (cityTime.getDate() > pragueTime.getDate() || (cityTime.getDate() === 1 && pragueTime.getDate() > 25)) {
                    dayDiffText = "Zítra";
                } else if (cityTime.getDate() < pragueTime.getDate() || (pragueTime.getDate() === 1 && cityTime.getDate() > 25)) {
                    dayDiffText = "Včera";
                }
                
                const pragueUTCHours = pragueTime.getUTCHours();
                const cityUTCHours = cityTime.getUTCHours();
                let hourDiff = cityUTCHours - pragueUTCHours;
                if (cityTime.getUTCDate() > pragueTime.getUTCDate()) hourDiff += 24;
                if (cityTime.getUTCDate() < pragueTime.getUTCDate()) hourDiff -= 24;

                content += `
                    <div class="list-item">
                        <div>
                            <div class="text-sm text-gray-400">${dayDiffText}, ${hourDiff >= 0 ? '+' : ''}${hourDiff} hod.</div>
                            <div class="text-xl text-white">${city.name}</div>
                        </div>
                        <div class="text-3xl font-light text-white">${cityTime.toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' })}</div>
                    </div>
                `;
            });
            content += `</div>`;
            appMainContent.innerHTML = content;
        }


        function renderAlarms() {
            let headerControls = `
                <button id="edit-alarms-btn" class="text-orange-500 text-lg">${isEditingAlarms ? 'Hotovo' : 'Upravit'}</button>
                <h1 class="text-2xl font-semibold text-center flex-grow -ml-10 text-white">Budíky</h1>
                <button id="add-alarm-btn" class="text-orange-500 text-3xl font-light">+</button>
            `;

            let listHtml = alarms.map(alarm => `
                <div class="list-item ${isEditingAlarms ? 'editing' : ''}" data-id="${alarm.id}">
                    <button class="delete-button" data-id="${alarm.id}">-</button>
                    <div class="flex-grow">
                        <div class="flex justify-between items-start">
                            <div class="alarm-text-content ${alarm.enabled ? '' : 'opacity-50'}">
                                <div class="text-4xl font-light text-white">${alarm.time}</div>
                                <div class="text-sm">
                                    <span class="text-white">${alarm.label}</span>, <span class="text-gray-400">${alarm.repeat}</span>
                                </div>
                            </div>
                            <label class="toggle-switch mt-1">
                                <input type="checkbox" ${alarm.enabled ? 'checked' : ''} data-id="${alarm.id}">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            `).join('');

            // pt-16 provides top padding for the header controls area, below status bar
            appMainContent.innerHTML = `
                <div class="app-header flex justify-between items-center px-4 pt-16"> 
                    ${headerControls}
                </div>
                <div class="divide-y divide-gray-700 mt-4">
                    ${listHtml}
                </div>
            `;

            document.getElementById('edit-alarms-btn').addEventListener('click', toggleEditAlarms);
            document.getElementById('add-alarm-btn').addEventListener('click', addAlarm);
            appMainContent.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.addEventListener('change', (e) => toggleAlarm(e.target.dataset.id, e.target.checked));
            });
            appMainContent.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', (e) => deleteAlarm(e.target.dataset.id));
            });
        }

        function toggleEditAlarms() {
            isEditingAlarms = !isEditingAlarms;
            renderAlarms();
        }

        function addAlarm() {
            const newId = Date.now();
            const newAlarmTime = new Date().toLocaleTimeString('cs-CZ', {hour: '2-digit', minute: '2-digit'});
            alarms.unshift({ 
                id: newId, 
                time: newAlarmTime, 
                label: "Nový budík", 
                repeat: "Nikdy", 
                enabled: true,
                days: [] 
            });
            if (isEditingAlarms) isEditingAlarms = false;
            renderAlarms();
        }

        function toggleAlarm(alarmId, isEnabled) {
            const alarm = alarms.find(a => a.id == alarmId);
            if (alarm) {
                alarm.enabled = isEnabled;
                const textContentDiv = appMainContent.querySelector(`.list-item[data-id="${alarmId}"] .alarm-text-content`);
                if (textContentDiv) {
                     textContentDiv.classList.toggle('opacity-50', !isEnabled);
                }
            }
        }
        
        function deleteAlarm(alarmId) {
            alarms = alarms.filter(a => a.id != alarmId);
            renderAlarms();
        }


        function formatStopwatchTime(timeInCentiseconds) {
            const cs = timeInCentiseconds % 100;
            const totalSeconds = Math.floor(timeInCentiseconds / 100);
            const s = totalSeconds % 60;
            const m = Math.floor(totalSeconds / 60);
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')},${String(cs).padStart(2, '0')}`;
        }

        function renderStopwatch() {
            // pt-16 provides top padding for the content area, below status bar
            appMainContent.innerHTML = `
                <div class="app-header text-center pt-16"> </div>
                <div class="flex flex-col items-center justify-center flex-grow px-4 pb-8">
                    <div id="stopwatch-display" class="text-7xl font-thin tracking-tighter mb-12 text-white">
                        ${formatStopwatchTime(stopwatchTime)}
                    </div>
                    <div id="stopwatch-laps" class="w-full overflow-y-auto max-h-48 mb-8 divide-y divide-gray-700">
                        ${renderStopwatchLaps()}
                    </div>
                    <div class="flex justify-around w-full">
                        <button id="stopwatch-lap-reset" class="control-button ${stopwatchRunning ? 'control-button-lap' : 'control-button-reset'}">
                            ${stopwatchRunning ? 'Mezičas' : (stopwatchTime > 0 ? 'Vynulovat' : 'Mezičas')}
                        </button>
                        <button id="stopwatch-start-stop" class="control-button ${stopwatchRunning ? 'control-button-stop' : 'control-button-start'}">
                            ${stopwatchRunning ? 'Zastavit' : 'Spustit'}
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('stopwatch-lap-reset').addEventListener('click', handleStopwatchLapReset);
            document.getElementById('stopwatch-start-stop').addEventListener('click', handleStopwatchStartStop);
        }
        
        function renderStopwatchLaps() {
            if (stopwatchLaps.length === 0 && !stopwatchRunning && stopwatchTime === 0) return '';
            let html = '';
            if (stopwatchRunning && stopwatchLaps.length > 0) {
                const lastLapTime = stopwatchLaps.reduce((sum, lap) => sum + lap.time, 0); // This was sum + lap.time, should be sum + lap.actualTime for correct current lap display if laps store split times
                // Correct calculation for current lap time: stopwatchTime - time of the start of this lap (which is sum of all previous laps' actualTime)
                const sumOfPreviousLapsActualTime = stopwatchLaps.length > 0 ? stopwatchLaps[stopwatchLaps.length-1].actualTime : 0;
                const currentLapTimeDisplay = stopwatchTime - sumOfPreviousLapsActualTime;

                 html += `<div class="lap-item">
                            <span class="lap-number">Kolo ${stopwatchLaps.length + 1}</span>
                            <span class="text-white">${formatStopwatchTime(currentLapTimeDisplay)}</span>
                          </div>`;
            } else if (stopwatchRunning && stopwatchLaps.length === 0 && stopwatchTime > 0) {
                 html += `<div class="lap-item">
                            <span class="lap-number">Kolo 1</span>
                            <span class="text-white">${formatStopwatchTime(stopwatchTime)}</span>
                          </div>`;
            }

            for (let i = stopwatchLaps.length - 1; i >= 0; i--) {
                html += `
                    <div class="lap-item">
                        <span class="lap-number">Kolo ${stopwatchLaps[i].lapNumber}</span>
                        <span class="text-white">${formatStopwatchTime(stopwatchLaps[i].time)}</span>
                    </div>`;
            }
            return html;
        }

        function updateStopwatchDisplay() {
            if (document.getElementById('stopwatch-display')) {
                document.getElementById('stopwatch-display').textContent = formatStopwatchTime(stopwatchTime);
            }
            if (document.getElementById('stopwatch-laps')) {
                if (stopwatchRunning) {
                    document.getElementById('stopwatch-laps').innerHTML = renderStopwatchLaps();
                }
            }
        }

        function handleStopwatchStartStop() {
            stopwatchRunning = !stopwatchRunning;
            if (stopwatchRunning) {
                clearInterval(stopwatchInterval);
                const startTime = Date.now() - stopwatchTime * 10;
                stopwatchInterval = setInterval(() => {
                    stopwatchTime = Math.floor((Date.now() - startTime) / 10);
                    updateStopwatchDisplay();
                }, 10);
            } else {
                clearInterval(stopwatchInterval);
            }
            renderStopwatch(); 
            updateStopwatchDisplay();
        }

        function handleStopwatchLapReset() {
            if (stopwatchRunning) { // Lap
                const sumOfPreviousLapsActualTime = stopwatchLaps.length > 0 ? stopwatchLaps[stopwatchLaps.length-1].actualTime : 0;
                const currentLapDuration = stopwatchTime - sumOfPreviousLapsActualTime;
                stopwatchLaps.push({ lapNumber: stopwatchLaps.length + 1, time: currentLapDuration, actualTime: stopwatchTime });
                document.getElementById('stopwatch-laps').innerHTML = renderStopwatchLaps();
            } else { // Reset
                stopwatchTime = 0;
                stopwatchLaps = [];
                stopwatchRunning = false;
                clearInterval(stopwatchInterval);
                renderStopwatch(); 
            }
            updateStopwatchDisplay();
        }


        function renderTimer() {
            const hours = Array.from({ length: 24 }, (_, i) => i);
            const minutesOrSeconds = Array.from({ length: 60 }, (_, i) => i);
            // pt-16 provides top padding for the content area, below status bar
            appMainContent.innerHTML = `
                <div class="app-header text-center pt-16"> </div>
                <div class="flex flex-col items-center justify-around flex-grow px-4 pb-8">
                    ${timerRunning || timerRemainingSeconds > 0 ? `
                        <div id="timer-countdown-display" class="text-7xl font-thin tracking-tighter mb-12 text-white">
                            ${formatTimerCountdown(timerRemainingSeconds)}
                        </div>
                    ` : `
                        <div class="timer-picker-container my-8">
                            <div class="timer-selection-indicator"></div>
                            <div id="timer-hours-picker" class="timer-picker-column">
                                ${hours.map(h => `<div class="timer-picker-item" data-value="${h}">${String(h).padStart(2, '0')}</div>`).join('')}
                            </div>
                            <div class="text-3xl mx-1 self-center pb-1 text-white">:</div>
                            <div id="timer-minutes-picker" class="timer-picker-column">
                                ${minutesOrSeconds.map(m => `<div class="timer-picker-item" data-value="${m}">${String(m).padStart(2, '0')}</div>`).join('')}
                            </div>
                            <div class="text-3xl mx-1 self-center pb-1 text-white">:</div>
                            <div id="timer-seconds-picker" class="timer-picker-column">
                                ${minutesOrSeconds.map(s => `<div class="timer-picker-item" data-value="${s}">${String(s).padStart(2, '0')}</div>`).join('')}
                            </div>
                        </div>
                    `}
                    <div class="flex justify-around w-full mt-auto" style="transform: translateY(-30px);">
                        <button id="timer-cancel-btn" class="control-button control-button-cancel ${ (timerRunning || timerRemainingSeconds > 0) ? '' : 'opacity-50 cursor-not-allowed'}" ${ (timerRunning || timerRemainingSeconds > 0) ? '' : 'disabled'}>
                            Zrušit
                        </button>
                        <button id="timer-start-pause-btn" class="control-button ${timerRunning ? 'control-button-pause' : 'control-button-start'}">
                            ${timerRunning ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8"><path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0a.75.75 0 01.75-.75h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75h-1.5a.75.75 0 01-.75-.75V5.25z" clip-rule="evenodd" /></svg>' : 'Spustit'}
                        </button>
                    </div>
                </div>
            `;
            
            if (!timerRunning && timerRemainingSeconds === 0) {
                setupTimerPickers();
            }

            document.getElementById('timer-cancel-btn').addEventListener('click', handleTimerCancel);
            document.getElementById('timer-start-pause-btn').addEventListener('click', handleTimerStartPause);
        }
        
        function setupTimerPickers() {
            timerPickers.hours = document.getElementById('timer-hours-picker');
            timerPickers.minutes = document.getElementById('timer-minutes-picker');
            timerPickers.seconds = document.getElementById('timer-seconds-picker');

            [timerPickers.hours, timerPickers.minutes, timerPickers.seconds].forEach(picker => {
                if (picker) {
                    picker.scrollTop = 0; 
                    updatePickerSelection(picker); 
                    picker.addEventListener('scroll', () => updatePickerSelection(picker));
                }
            });
        }

        function updatePickerSelection(pickerElement) {
            if (!pickerElement) return;
            const itemHeight = 40; 
            const selectedIndex = Math.round(pickerElement.scrollTop / itemHeight);
            
            pickerElement.querySelectorAll('.timer-picker-item').forEach((item, index) => {
                item.classList.toggle('selected', index === selectedIndex);
            });
        }
        
        function getPickerValue(pickerElement) {
            if (!pickerElement) return 0;
            const itemHeight = 40;
            const selectedIndex = Math.round(pickerElement.scrollTop / itemHeight);
            const selectedItem = pickerElement.children[selectedIndex];
            return selectedItem ? parseInt(selectedItem.dataset.value) : 0;
        }

        function formatTimerCountdown(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function updateTimerCountdownDisplay() {
            const display = document.getElementById('timer-countdown-display');
            if (display) {
                display.textContent = formatTimerCountdown(timerRemainingSeconds);
            }
        }

        function handleTimerStartPause() {
            if (timerRunning) { 
                timerRunning = false;
                clearInterval(timerInterval);
            } else { 
                if (timerRemainingSeconds === 0) { 
                    const hours = getPickerValue(timerPickers.hours);
                    const minutes = getPickerValue(timerPickers.minutes);
                    const seconds = getPickerValue(timerPickers.seconds);
                    timerTotalSeconds = (hours * 3600) + (minutes * 60) + seconds;
                    if (timerTotalSeconds === 0) return; 
                    timerRemainingSeconds = timerTotalSeconds;
                }
                timerRunning = true;
                timerInterval = setInterval(() => {
                    timerRemainingSeconds--;
                    if (timerRemainingSeconds < 0) {
                        clearInterval(timerInterval);
                        timerRunning = false;
                        timerRemainingSeconds = 0;
                        // Simple alert, replace with a nicer modal if desired
                        const alertDiv = document.createElement('div');
                        alertDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #333; color: white; padding: 20px; border-radius: 10px; z-index: 200; box-shadow: 0 0 15px rgba(0,0,0,0.5); text-align: center;';
                        alertDiv.innerHTML = 'Minutka dokončena!<br><button id="timer-alert-ok" style="background-color: #ff9500; color: white; padding: 8px 15px; border-radius: 5px; border: none; margin-top: 15px; cursor: pointer;">OK</button>';
                        document.body.appendChild(alertDiv);
                        document.getElementById('timer-alert-ok').onclick = () => {
                            alertDiv.remove();
                            renderTimer(); // Re-render to show pickers again
                        };
                    }
                    if (document.getElementById('timer-countdown-display')) {
                        updateTimerCountdownDisplay();
                    } else { 
                        renderTimer();
                        updateTimerCountdownDisplay();
                    }
                     if (timerRemainingSeconds <= 0 && !document.querySelector('div[style*="position: fixed"]')) { // Check if alert is not already shown
                         renderTimer(); 
                     }
                }, 1000);
            }
            renderTimer(); 
            if (timerRunning || timerRemainingSeconds > 0) updateTimerCountdownDisplay();
        }

        function handleTimerCancel() {
            clearInterval(timerInterval);
            timerRunning = false;
            timerTotalSeconds = 0;
            timerRemainingSeconds = 0;
            renderTimer();
        }


        function switchTab(tabName) {
            tabButtons.forEach(button => {
                button.classList.toggle('active', button.dataset.tab === tabName);
            });

            isEditingAlarms = false; 

            if (tabName === 'world-clock') {
                renderWorldClock();
            } else if (tabName === 'alarms') {
                renderAlarms();
            } else if (tabName === 'stopwatch') {
                renderStopwatch();
                updateStopwatchDisplay(); 
            } else if (tabName === 'timer') {
                renderTimer();
                 if (timerRunning || timerRemainingSeconds > 0) updateTimerCountdownDisplay();
            }
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => switchTab(button.dataset.tab));
        });

        // Initial tab
        switchTab('world-clock');
    </script>
</body>
</html>
